package ${packageName};

import com.skunkworks.fastorm.Repository;

import javax.sql.DataSource;
import java.sql.CallableStatement;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.Types;
import java.util.ArrayList;
import java.util.List;

public class ${className}Repository implements Repository<${className}> {

    private final DataSource dataSource;

    public ${className}Repository(DataSource dataSource) {
        this.dataSource = dataSource;
    }

    @Override
    public List<${className}> loadAll() throws Exception {
        Connection connection = dataSource.getConnection();
        CallableStatement callableStatement = connection.prepareCall("select ${selectColumns} from ${className}");
        ResultSet resultSet = callableStatement.executeQuery();
        List<${className}> items = new ArrayList<>();
        while (resultSet.next()) {
            items.add(mapToRow(resultSet));
        }
        return items;
    }

    //${selectColumns}
    public static ${className} mapToRow(ResultSet resultSet) throws Exception {
        ${className} item = new ${className}();
        #foreach($field in $fields)
        item.${field.setter}(resultSet.get${field.recordsetType}(${field.index}));
        #end
        return item;
    }
}